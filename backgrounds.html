<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Backgrounds - gbadoc</title>


        <!-- Custom HTML head -->
        <!-- Matomo tracking code -->
        <script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//stats.gbdev.io/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '3']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Matomo Code -->

        <meta name="description" content="Documents the workings of the Game Boy Advance hardware">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">gbadoc</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="backgrounds"><a class="header" href="#backgrounds">Backgrounds</a></h1>
<style>
tt {
  white-space: pre;
}
</style>
<p>Depending on the current <a href="graphics.html#video-modes">video mode</a>, three different types of backgrounds are available. They are:</p>
<h3 id="text-backgrounds"><a class="header" href="#text-backgrounds">Text Backgrounds</a></h3>
<p>These are tile-based backgrounds that descend from the usage of tiles to display characters in text modes of a PC or workstation. They are made up of 8x8 tiles, the bitmaps of which are stored at the tile data address. The address of this data is set using registers <a href="registers.html#REG_BGCNT">REG_BG0CNT - REG_BG3CNT</a>. The <a href="registers.html#REG_BGOFS">HOFS / VOFS</a> registers can be used to scroll around a larger area of up to 512x512 pixels (or 64 x 64 tiles).</p>
<p>In text backgrounds, the data for each pixel is stored as an 8 or 4 bit palette index. In 8-bit mode, the <a href="memory.html#palette-ram">palette</a> is at <code>0x05000000</code> stores a 15-bit color value for each of the 256 palette entries. In 4-bit mode, the the map index contains a 4-bit value indicating which of 16 16-color palettes to use for each tile. Each of these palettes is 32 bytes long and can be found at <code>0x05000000</code>, <code>0x05000020</code>, etc.</p>
<h3 id="scalerotate-backgrounds"><a class="header" href="#scalerotate-backgrounds">Scale/Rotate Backgrounds</a></h3>
<p>These backgrounds are also tile-based, and operate similarly to Text Backgrounds. However, these backgrounds may also be <a href="registers.html#background-rotation-scaling-registers">scaled or rotated</a>. Additionally they may only use an 8-bit palette, and can vary in size from 128 to 1024 pixels across. The palette is at <code>0x05000000</code>, and contains 256 16-bit <a href="graphics.html#color-format">color entries</a></p>
<h3 id="bitmapped-backgrounds"><a class="header" href="#bitmapped-backgrounds">Bitmapped Backgrounds</a></h3>
<p>These backgrounds vary depending on the <a href="graphics.html#video-modes">video mode</a>, but in all cases they rely on a single buffer upon which the image is drawn, either using an 8-bit palette or 16-bit color entries themsevles. Bitmap backgrounds are treated as BG2 for purposes of rotation, scaling, and blending. In the bitmap modes the frame buffer data extends into the obj tile data region, limiting it to the range from <code>0x06014000</code> - <code>0x06018000</code> (sprite indices 512 - 1024).</p>
<h2 id="background-map-entry-format"><a class="header" href="#background-map-entry-format">Background Map Entry Format</a></h2>
<h3 id="text-background-map-format"><a class="header" href="#text-background-map-format">Text Background Map Format</a></h3>
<p>The tile map, which stores the layout of the tiles on screen, begins at the tile map address found for a particular background, detrmined by <a href="registers.html#REG_BG0">REG_BG0CNT - REG_BG3CNT</a>. It has a selectable size up to 512x512. The tile map contains a 16-bit entry for each tile, with has the following format:</p>
<div>
<PRE style="width: min-content; margin: 16px auto">F E D C  B A 9 8  7 6 5 4  3 2 1 0 
<FONT COLOR="#008800">L L L L</FONT>  <FONT COLOR="#0099FF">V</FONT> <FONT COLOR="#9900CC">H</FONT> <FONT COLOR="#FF0099">T T  T T T T  T T T T</FONT> </PRE>
</div>
<div class="table-wrapper"><table><thead><tr><th>Bits</th><th>Description</th></tr></thead><tbody>
<tr><td><tt>0-9 <FONT COLOR="#FF0099">(T)</FONT></tt></td><td>The tile number</td></tr>
<tr><td><tt>  A <FONT COLOR="#9900CC">(H)</FONT></tt></td><td>If this bit is set, the tile is flipped horizontally left to right.</td></tr>
<tr><td><tt>  B <FONT COLOR="#0099FF">(V)</FONT></tt></td><td>If this bit is set, the tile is flipped vertically upside down.</td></tr>
<tr><td><tt>C-F <FONT COLOR="#008800">(L)</FONT></tt></td><td>Palette number</td></tr>
</tbody></table>
</div>
<p>For 256 x 256 and 256 x 512 backgrounds, the formula for calculating a map index is roughly,</p>
<pre><code>mapEntry = tileMapAddress[(tileY * 32) + tileX]
</code></pre>
<p>For text mode sizes 512 x 256 and 512 x 512 backgrounds, however, the map is 64 tiles across, and these are stored in blocks of 32 * 32 tiles. This means that to calculate the map entry that would appear 33 tiles or more across the background, the following equation should be used:</p>
<pre><code>mapEntry = tileMap[(tileY * 32) + (tileX - 32) + 32*32]
</code></pre>
<p>For entries 33 tiles or more down (in mode 11), use</p>
<pre><code>mapEntry = tileMap[((tileY-32) * 32) + tileX + 2*32*32]
</code></pre>
<p>And for entries 33 tiles or more down and 33 tiles or more across,</p>
<pre><code>mapEntry = tileMap[((tileY-32) * 32) + (tileX-32) + 3*32*32]
</code></pre>
<h3 id="rotational-background-map-format"><a class="header" href="#rotational-background-map-format">Rotational Background Map Format</a></h3>
<p>This is the same idea as the text background map format, but you only have 8 bits for each entry. The format for the tile map entries is:</p>
<html>
<PRE style="width: min-content; margin: 16px auto">7 6 5 4 3 2 1 0 
<FONT COLOR="#FF0099">T T T T T T T T</FONT> </PRE>
</html>
<div class="table-wrapper"><table><thead><tr><th>Bits</th><th>Description</th></tr></thead><tbody>
<tr><td><tt>0-7 <FONT COLOR="#FF0099">(T)</FONT></tt></td><td>The tile number</td></tr>
</tbody></table>
</div>
<p>Rotational backgrounds do not divide tile maps into blocks.</p>
<br>
<hr />
<br>
<p>For specific details on the format of background data and map entries, check out the section on <a href="registers.html#REG_BGCNT">REG_BG0CNT - REG_BG3CNT</a> (addresses <code>0x04000008</code> - <code>0x0400000E</code>).</p>
<p>In all modes, up to 128 sprites can be displayed as well as the 4 background layers. These use the second <a href="memory.html#palette-ram">palette</a> which is located at <code>0x05000200</code>. See the <a href="sprites.html">OAM</a> section for details on how to display sprites.</p>
<p>Both background tiles and sprites use palette entry 0 as the transparent color. Pixels in this color will not be drawn, and allow other background layers and sprites to show through.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="graphics.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="sprites.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="graphics.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="sprites.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
