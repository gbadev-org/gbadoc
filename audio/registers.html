<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sound Registers - gbadoc</title>


        <!-- Custom HTML head -->
        <!-- Matomo tracking code -->
        <script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//stats.gbdev.io/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '3']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Matomo Code -->

        <meta name="description" content="Documents the workings of the Game Boy Advance hardware">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">gbadoc</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="gba-sound-registers"><a class="header" href="#gba-sound-registers">GBA Sound Registers</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Adress</th><th>Name</th><th>Function</th></tr></thead><tbody>
<tr><td>0x04000060</td><td>REG_SOUND1CNT_L</td><td>Sound 1 Sweep control</td></tr>
<tr><td>0x04000062</td><td>REG_SOUND1CNT_H</td><td>Sound 1 Length, wave duty and envelope control</td></tr>
<tr><td>0x04000064</td><td>REG_SOUND1CNT_X</td><td>Sound 1 Frequency, reset and loop control</td></tr>
<tr><td>0x04000068</td><td>REG_SOUND2CNT_L</td><td>Sound 2 Lenght, wave duty and envelope control</td></tr>
<tr><td>0x0400006C</td><td>REG_SOUND2CNT_H</td><td>Sound 2 Frequency, reset and loop control</td></tr>
<tr><td>0x04000070</td><td>REG_SOUND3CNT_L</td><td>Sound 3 Enable and wave ram bank control</td></tr>
<tr><td>0x04000072</td><td>REG_SOUND3CNT_H</td><td>Sound 3 Sound lenght and output level control</td></tr>
<tr><td>0x04000074</td><td>REG_SOUND3CNT_X</td><td>Sound 3 Frequency, reset and loop control</td></tr>
<tr><td>0x04000078</td><td>REG_SOUND4CNT_L</td><td>Sound 4 Length, output level and envelope control</td></tr>
<tr><td>0x0400007C</td><td>REG_SOUND4CNT_H</td><td>Sound 4 Noise parameters, reset and loop control</td></tr>
<tr><td>0x04000080</td><td>REG_SOUNDCNT_L</td><td>Sound 1-4 Output level and Stereo control</td></tr>
<tr><td>0x04000082</td><td>REG_SOUNDCNT_H</td><td>Direct Sound control and Sound 1-4 output ratio</td></tr>
<tr><td>0x04000084</td><td>REG_SOUNDCNT_X</td><td>Master sound enable and Sound 1-4 play status</td></tr>
<tr><td>0x04000088</td><td>REG_SOUNDBIAS</td><td>Sound bias and Amplitude resolution control</td></tr>
<tr><td>0x04000090</td><td>REG_WAVE_RAM0_L</td><td>Sound 3 samples 0-3</td></tr>
<tr><td>0x04000092</td><td>REG_WAVE_RAM0_H</td><td>Sound 3 samples 4-7</td></tr>
<tr><td>0x04000094</td><td>REG_WAVE_RAM1_L</td><td>Sound 3 samples 8-11</td></tr>
<tr><td>0x04000096</td><td>REG_WAVE_RAM1_H</td><td>Sound 3 samples 12-15</td></tr>
<tr><td>0x04000098</td><td>REG_WAVE_RAM2_L</td><td>Sound 3 samples 16-19</td></tr>
<tr><td>0x0400009A</td><td>REG_WAVE_RAM2_H</td><td>Sound 3 samples 20-23</td></tr>
<tr><td>0x0400009C</td><td>REG_WAVE_RAM3_L</td><td>Sound 3 samples 23-27</td></tr>
<tr><td>0x0400009E</td><td>REG_WAVE_RAM3_H</td><td>Sound 3 samples 28-31</td></tr>
<tr><td>0x040000A0</td><td>REG_FIFO_A_L</td><td>Direct Sound channel A samples 0-1</td></tr>
<tr><td>0x040000A2</td><td>REG_FIFO_A_H</td><td>Direct Sound channel A samples 2-3</td></tr>
<tr><td>0x040000A4</td><td>REG_FIFO_B_L</td><td>Direct Sound channel B samples 0-1</td></tr>
<tr><td>0x040000A6</td><td>REG_FIFO_B_H</td><td>Direct Sound channel B samples 2-3</td></tr>
</tbody></table>
</div>
<h2 id="dmg-sound-output-control"><a class="header" href="#dmg-sound-output-control">DMG Sound Output Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x080</td><td>REG_SOUNDCNT_L</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>2-0</td><td>DMG Left Volume</td><td>RW</td></tr>
<tr><td>3</td><td>Vin to Left on/off (?)</td><td></td></tr>
<tr><td>6-4</td><td>DMG Right Volume</td><td>RW</td></tr>
<tr><td>7</td><td>Vin to Right on/off (?)</td><td></td></tr>
<tr><td>8</td><td>DMG Sound 1 to left output</td><td>RW</td></tr>
<tr><td>9</td><td>DMG Sound 2 to left output</td><td>RW</td></tr>
<tr><td>A</td><td>DMG Sound 3 to left output</td><td>RW</td></tr>
<tr><td>B</td><td>DMG Sound 4 to left output</td><td>RW</td></tr>
<tr><td>C</td><td>DMG Sound 1 to right output</td><td>RW</td></tr>
<tr><td>D</td><td>DMG Sound 2 to right output</td><td>RW</td></tr>
<tr><td>E</td><td>DMG Sound 3 to right output</td><td>RW</td></tr>
<tr><td>F</td><td>DMG Sound 4 to right output</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>This register controls only the DMG output amplifiers and have no effects on the individual sound channels processing, or Direct Sound channels volume.</li>
<li>Vin Left/Right were used on the original gameboy to enable gamepaks to provide their own sound source. It is currently unknown if this function is still supported and working on the GBA.</li>
</ol>
<h2 id="direct-sound-output-control-register"><a class="header" href="#direct-sound-output-control-register">Direct Sound Output Control Register</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x082</td><td>REG_SOUNDCNT_H</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>1-0</td><td>Output sound ratio for chan. 1-4 (0=25%,1=50%,2=100%)</td><td>RW</td></tr>
<tr><td>2</td><td>Direct sound A output ratio (0=50%, 1=100%)</td><td>RW</td></tr>
<tr><td>3</td><td>Direct sound B output ratio (0=50%, 1=100%)</td><td>RW</td></tr>
<tr><td>7-4</td><td>Unused</td><td></td></tr>
<tr><td>8</td><td>Direct sound A to right output</td><td>RW</td></tr>
<tr><td>9</td><td>Direct sound A to left output</td><td>RW</td></tr>
<tr><td>A</td><td>Direct sound A Sampling rate timer (timer 0 or 1)</td><td>RW</td></tr>
<tr><td>B</td><td>Direct sound A FIFO reset</td><td>RW</td></tr>
<tr><td>C</td><td>Direct sound B to right output</td><td>RW</td></tr>
<tr><td>D</td><td>Direct sound B to left output</td><td>RW</td></tr>
<tr><td>E</td><td>Direct sound B Sampling rate timer (timer 0 or 1)</td><td>RW</td></tr>
<tr><td>F</td><td>Direct sound B FIFO reset</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Output ratios control the output volume. Use when DMG channels or Direct Sound plays too loud relative to each other.</li>
<li>Direct Sound is a dual 8-bit DAC fed by data located in two FIFOs. FIFOs can be loaded manually or automatically in DMA mode when set appropriately. The DMA mode uses the timers specified in bits A and E as the sampling frequency reference. A single timer can be used for both DirectSound A&amp;B. However, 2 DMA channels (1&amp;2) must be used to output two different sounds simultaneously on both channels. Also, DMA channel start mode must be set to 11 to instruct it to repeat on FIFO-empty requests.</li>
</ol>
<h2 id="master-sound-output-controlstatus"><a class="header" href="#master-sound-output-controlstatus">Master Sound Output Control/Status</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x084</td><td>REG_SOUNDCNT_X</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>0</td><td>DMG Sound 1 status</td><td>R</td></tr>
<tr><td>1</td><td>DMG Sound 2 status</td><td>R</td></tr>
<tr><td>2</td><td>DMG Sound 3 status</td><td>R</td></tr>
<tr><td>3</td><td>DMG Sound 4 status</td><td>R</td></tr>
<tr><td>6-4</td><td>Unused</td><td></td></tr>
<tr><td>7</td><td>All sound circuit enable (0=off, 1=on)</td><td>RW</td></tr>
<tr><td>F-8</td><td>Unused</td><td></td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Bits 0-3 are set when their respective sound channels are playing and are resetted when sound has stopped. Note that contrary to some other sources and most emulators, these bits are read-only and do not need to be set to enable the sound channels.</li>
<li>Bit 7 turns on or off the entire sound circuit (DMG and Direct Sound). Keep this bit cleared as often as possible in order to save battery power. Some sources states that it allows batteries to last up to 10% longer.</li>
</ol>
<h2 id="sound-bias"><a class="header" href="#sound-bias">Sound Bias</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x088</td><td>REG_SOUNDBIAS</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>9-0</td><td>DC offset bias value</td><td>RW</td></tr>
<tr><td>D-A</td><td>Unused</td><td></td></tr>
<tr><td>F-E</td><td>PWM resampling resolution where: <br> 00=9bit at 32768 Hz <br> 01= 8bit at 65536 Hz <br> 10=7bit at 131072 Hz <br> 11= 6bit at 262144 Hz</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The BIAS setting is used to offset the sound output and bring it back into a signed range. When the BIOS starts up, it runs a timing loop where it slowly raises the BIAS voltage from 0 to 512. This setting should not be changed. At best, the sound will become distorted. At worst the amplifier inside the GBA could be damaged. When accessing bits FE, a read-modify-write is required.</li>
<li>The default value for bits FE is 00. Most if not all games, uses 01 for this setting. More research is being done on this register.</li>
</ol>
<h2 id="directsound-fifo-a"><a class="header" href="#directsound-fifo-a">DirectSound FIFO A</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x0A0-0x0A2</td><td>REG_FIFO_A</td></tr>
</tbody></table>
</div>
<h3 id="0x0a0"><a class="header" href="#0x0a0">0x0A0</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>7-0</td><td>8-Bit sample 0</td><td>W</td></tr>
<tr><td>F-8</td><td>8-Bit sample 1</td><td>W</td></tr>
</tbody></table>
</div>
<h3 id="0x0a2"><a class="header" href="#0x0a2">0x0A2</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>7-0</td><td>8-Bit sample 2</td><td>W</td></tr>
<tr><td>F-8</td><td>8-Bit sample 3</td><td>W</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>These registers contains the samples required for Direct Sound channel A output.</li>
<li>Reading from this register yields unpredictable results.</li>
</ol>
<h2 id="directsound-fifo-b"><a class="header" href="#directsound-fifo-b">DirectSound FIFO B</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x0A4-0x0A6</td><td>REG_FIFO_B</td></tr>
</tbody></table>
</div>
<h3 id="0x0a4"><a class="header" href="#0x0a4">0x0A4</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>7-0</td><td>8-Bit sample 0</td><td>W</td></tr>
<tr><td>F-8</td><td>8-Bit sample 1</td><td>W</td></tr>
</tbody></table>
</div>
<h3 id="0x0a6"><a class="header" href="#0x0a6">0x0A6</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>7-0</td><td>8-Bit sample 2</td><td>W</td></tr>
<tr><td>F-8</td><td>8-Bit sample 3</td><td>W</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>These registers contains the samples required for Direct Sound channel B output.</li>
<li>Reading from this register yields unpredictable results.</li>
</ol>
<h2 id="dmg-channel-1-sweep-control"><a class="header" href="#dmg-channel-1-sweep-control">DMG Channel 1 Sweep control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x60</td><td>REG_SOUND1CNT_L</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>2-0</td><td>Sweep shifts</td><td>RW</td></tr>
<tr><td>3</td><td>Sweep increase/decrease: <br> 0=Addition(frequency increases) <br> 1=Subtraction (frequency decreases)</td><td>RW</td></tr>
<tr><td>6-4</td><td>Sweep time: <br> 000: Sweep function is off <br> 001: Ts=1 / 128Khz (7.8 ms) <br> 010: Ts=2 / 128Khz (15.6 ms) <br> 011: Ts=3 / 128Khz (23.4 ms) <br> 100: Ts=4 / 128Khz (31.3 ms) <br> 101: Ts=5 / 128Khz (39.1 ms) <br> 110: Ts=6 / 128Khz (46.9 ms) <br> 111: Ts=7 / 128Khz (54.7 ms)</td><td>RW</td></tr>
<tr><td>F-7</td><td>Unused</td><td></td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The sound channel 1 produces a square wave with envelope and frequency sweep functions.</li>
<li>This register controls the frequency sweep function. Sweep shifts bits controls the amount of change in frequency (either increase or decrease) at each change. The wave's new period is given by: \( T = T \pm \frac{T}{2^n} \) where n is the sweep shifts value.</li>
<li>Sweep time is the delay between sweep shifts. After each delay, frequency changes repeatedly.</li>
<li>When decrementing, if the frequency value gets smaller than zero, the previous value is retained. When incrementing, if the frequency gets greater than the maximum frequency (131Khz or 2048 for the register value) the sound stops.</li>
<li>When the sweep function is not required, set the sweep time to zero and set the increase/decrease bit to 1.</li>
<li>When Initializing the sound (REG_SOUND1CNT_X bit F=1) using sweeps, re-initialize the sound after 8 clocks or more. Otherwise the sound may stop.</li>
</ol>
<h2 id="dmg-channel-1-length-wave-duty-and-envelope-control"><a class="header" href="#dmg-channel-1-length-wave-duty-and-envelope-control">DMG Channel 1 Length, Wave Duty and Envelope Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x062</td><td>REG_SOUND1CNT_H</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>5-0</td><td>Sound length</td><td>W</td></tr>
<tr><td>7-6</td><td>Wave duty cycle: <br> 00=12.5% <br> 01=25% <br> 10=50% <br> 11=75%</td><td>RW</td></tr>
<tr><td>A-8</td><td>Envelope step time</td><td>RW</td></tr>
<tr><td>B</td><td>Envelope mode: <br> 0=Envelope decreases <br> 1=Envelope increases</td><td>RW</td></tr>
<tr><td>F-C</td><td>Initial envelope value</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The sound length is an 6 bit value obtained from the following formula: Sound length= (64-register value)*(1/256) seconds.</li>
<li>After the sound length has been changed, the sound channel must be resetted via bit F of REG_SOUND1CNT_X (when using timed mode).</li>
<li>Wave duty cycle control the percentage of the ON state of the square wave.</li>
<li>The envelope step time is the delay between successive envelope increase or decrease. It is given by the following formula: T=register value*(1/64) seconds.</li>
<li>Envelope mode control if the envelope is to increase or decrease in volume over time.</li>
<li>The initial volume of the envelope is controlled by bit F-C. 1111 produces the maximum volume and 0000 mutes the sound.</li>
</ol>
<h2 id="dmg-channel-1-frequency-reset-and-loop-control"><a class="header" href="#dmg-channel-1-frequency-reset-and-loop-control">DMG Channel 1 Frequency, Reset and Loop Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x064</td><td>REG_SOUND1CNT_X</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>A-0</td><td>Sound frequency</td><td>W</td></tr>
<tr><td>D-B</td><td>Unused</td><td></td></tr>
<tr><td>E</td><td>Timed mode: <br> 0=continuous, 1=timed</td><td>RW</td></tr>
<tr><td>F</td><td>Sound Reset</td><td>W</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Frequency can be calculated from the following formula: F(hz)=4194304/(32*(2048-register value)). The minimum frequency is 64Hz and the maximum is 131Khz.</li>
<li>When Bit E (Timed mode) is set to 0, sound 1 is played continuously regardless of the length data in REG_SOUND1CNT_H. When set to 1, sound is played for that specified length and after that, bit 0 of REG_SOUNDCNT_X is reset.</li>
<li>When bit F is set to 1, the envelope is resetted to its initial value and sound restarts at the specified frequency.</li>
<li>Frequency can always be changed without resetting the sound. However, when in continuous mode, alway set the sound lenght to zero after changing the frequency. Otherwise, the sound may stop.</li>
</ol>
<h2 id="dmg-channel-2-length-wave-duty-and-envelope-control"><a class="header" href="#dmg-channel-2-length-wave-duty-and-envelope-control">DMG Channel 2 Length, Wave Duty and Envelope Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x068</td><td>REG_SOUND2CNT_L</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>5-0</td><td>Sound length</td><td>W</td></tr>
<tr><td>7-6</td><td>Wave duty cycle: <br> 00=12.5% <br> 01=25% <br> 10=50% <br> 11=75%</td><td>RW</td></tr>
<tr><td>A-8</td><td>Envelope step time</td><td>RW</td></tr>
<tr><td>B</td><td>Envelope mode: <br> 0=Envelope decreases <br> 1=Envelope increases</td><td>RW</td></tr>
<tr><td>F-C</td><td>Initial envelope value</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The sound length is an 6 bit value obtained from the following formula: Sound length= (64-register value)*(1/256) seconds.</li>
<li>After the sound length has been changed, the sound channel must be resetted via bit F of REG_SOUND2CNT_H (when using timed mode).</li>
<li>Wave duty cycle control the percentage of the ON state of the square wave.</li>
<li>The envelope step time is the delay between successive envelope increase or decrease. It is given by the following formula: T=register value*(1/64) seconds.</li>
<li>Envelope mode control if the envelope is to increase or decrease in volume over time.</li>
<li>The initial volume of the envelope is controlled by bit F-C. 1111 produces the maximum volume and 0000 mutes the sound.</li>
</ol>
<h2 id="dmg-channel-2-frequency-reset-and-loop-control"><a class="header" href="#dmg-channel-2-frequency-reset-and-loop-control">DMG Channel 2 Frequency, Reset and Loop Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x06C</td><td>REG_SOUND2CNT_H</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>A-0</td><td>Sound frequency</td><td>W</td></tr>
<tr><td>D-B</td><td>Unused</td><td></td></tr>
<tr><td>E</td><td>Timed mode: <br> 0=continuous, 1=timed</td><td>RW</td></tr>
<tr><td>F</td><td>Sound Reset</td><td>W</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Frequency can be calculated from the following formula: F(Hz)=4194304/(32*(2048-register value)). The minimum frequency is 64Hz and the maximum is 131Khz.</li>
<li>When Bit E (Timed mode) is set to 0, sound 2 is played continuously regardless of the length data in REG_SOUND2CNT_L. When set to 1, sound is played for that specified length and after that, bit 1 of REG_SOUNDCNT_X is reset.</li>
<li>When bit F is set to 1, the envelope is resetted to its initial value and sound restarts at the specified frequency.</li>
<li>Frequency can always be changed without resetting the sound. However, when in continuous mode, alway set the sound lenght to zero after changing the frequency. Otherwise, the sound may stop.</li>
</ol>
<h2 id="dmg-channel-3-enable-and-wave-ram-bank-control"><a class="header" href="#dmg-channel-3-enable-and-wave-ram-bank-control">DMG Channel 3 Enable and Wave RAM Bank Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x070</td><td>REG_SOUND3CNT_L</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>4-0</td><td>Unused</td><td></td></tr>
<tr><td>5</td><td>Bank Mode (0=2x32, 1=1x64)</td><td>RW</td></tr>
<tr><td>6</td><td>Bank Select (Non set bank is written to)</td><td>RW</td></tr>
<tr><td>7</td><td>Sound Channel 3 output enable</td><td>RW</td></tr>
<tr><td>F-8</td><td>Unused</td><td></td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The sound channel 3 is a circuit that can produce an arbitrary wave pattern. Samples are 4 bit, 8 samples per word, and are located in Wave Ram registers from 0x400090 to 0x40009F.</li>
<li>In the Gameboy Advance, the Wave Ram is banked, providing the ability to play a 64 samples pattern or to select between two 32 samples patterns (Bit 5). Sound channel 3 always produces some audio artifacts (distortion) when sound is initialized. Fortunately, switching banks does not require re-initialisation during playback, thus allowing for dynamic reloading of the Wave Ram without generating any distortion.</li>
<li>Bit 6 controls which bank is active for playing/reloading. If set to 0, samples are played from bank 0 and writing to the Wave Ram will store the data in Bank 1 and vice-versa.</li>
<li>When bit 7 is set and Initial flag (Bit 15) from REG_SOUND3CNT_X is set, the wave pattern starts to play.</li>
<li>Both banks of Wave Ram are filled with zero upon initialization of the Gameboy, Bank 0 being selected. So writing to bank 0 implies setting bit 6 to 1 before loading Wave Ram then set it back to 0 to play it. Most emulator currently ignore banks.</li>
</ol>
<h2 id="dmg-channel-3-sound-length-and-output-level-control"><a class="header" href="#dmg-channel-3-sound-length-and-output-level-control">DMG Channel 3 Sound Length and Output Level Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x072</td><td>REG_SOUND3CNT_H</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>7-0</td><td>Sound length</td><td>W</td></tr>
<tr><td>C-8</td><td>Unused</td><td></td></tr>
<tr><td>F-D</td><td>Ouput volume ratio: <br> 000=Mute <br> 001=100% <br> 100=75% <br> 010=50% <br> 011=25%</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The sound length is an 8 bit value obtained from the following formula: Register=Note length(in seconds)*256, hence a 1 second maximum and a 3.9 millisecond minimum sound duration.</li>
<li>After the sound length has be changed, the sound channel must be resetted via bit F of REG_SOUND3CNT_H (when using timed mode).</li>
</ol>
<h2 id="dmg-channel-3-frequency-reset-and-loop-control"><a class="header" href="#dmg-channel-3-frequency-reset-and-loop-control">DMG Channel 3 Frequency, Reset and Loop Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x074</td><td>REG_SOUND3CNT_X</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>A-0</td><td>Sound frequency</td><td>W</td></tr>
<tr><td>D-B</td><td>Unused</td><td></td></tr>
<tr><td>E</td><td>Timed mode: <br> 0=continuous, 1=timed</td><td>RW</td></tr>
<tr><td>F</td><td>Sound Reset</td><td>W</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Frequency can be calculated from the following formula: F(Hz)=4194304/(32*(2048-register value)). The minimum frequency is 64Hz and the maximum is 131Khz.</li>
<li>When Bit E (Timed mode) is set to 0, sound 3 is played continuously regardless of the length data in REG_SOUND3CNT_H. When set to 1, sound is played for that specified length and after that, bit 2 of REG_SOUNDCNT_X is reset.</li>
<li>When bit F is set to 1, sound resets and restarts at the specified frequency. Frequency and sound reset must be performed in a single write since both are write only.</li>
<li>Note that in continuous mode, frequency can be changed without resetting the sound channel. However, when in continuous mode, alway set the sound lenght to zero after changing the frequency. Otherwise, the sound may stop.</li>
</ol>
<h2 id="dmg-channel-3-wave-ram-registers"><a class="header" href="#dmg-channel-3-wave-ram-registers">DMG Channel 3 Wave RAM Registers</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x090-0x09F</td><td>REG_WAVERAM0-3</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>3-0</td><td>4-bit sample 0</td><td>RW</td></tr>
<tr><td>7-4</td><td>4-bit sample 1</td><td>RW</td></tr>
<tr><td>B-8</td><td>4-bit sample 2</td><td>RW</td></tr>
<tr><td>F-C</td><td>4-bit sample 3</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Wave ram spans four 32 bit registers.</li>
<li>Take into account that ARM store 32bit words in little-indian format. So if you load REG_WAVERAM0=0x01234567, in reality, the sample played will be 6-7-4-5-2-3-0-1.</li>
</ol>
<h2 id="dmg-channel-4-length-output-level-and-envelope-control"><a class="header" href="#dmg-channel-4-length-output-level-and-envelope-control">DMG Channel 4 Length, Output Level and Envelope Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x78</td><td>REG_SOUND4CNT_L</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>5-0</td><td>Sound length</td><td>W</td></tr>
<tr><td>7-6</td><td>Unused</td><td></td></tr>
<tr><td>A-8</td><td>Envelope step time</td><td>RW</td></tr>
<tr><td>B</td><td>Envelope mode: <br> 0=Envelope decreases <br> 1=Envelope increases</td><td>RW</td></tr>
<tr><td>F-C</td><td>Initial envelope value</td><td>RW</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>The sound length is an 6 bit value obtained from the following formula: Sound length= (64-register value)*(1/256) seconds.</li>
<li>After the sound length has been changed, the sound channel must be resetted via bit F of REG_SOUND4CNT_H (when using timed mode).</li>
<li>The envelope step time is the delay between successive envelope increase or decrease. It is given by the following formula: T=register value*(1/64) seconds.</li>
<li>Envelope mode control if the envelope is to increase or decrease in volume over time.</li>
<li>The initial volume of the envelope is controlled by bit F-C. 1111 produces the maximum volume and 0000 mutes the sound.</li>
</ol>
<h2 id="dmg-channel-4-noise-parameters-reset-and-loop-control"><a class="header" href="#dmg-channel-4-noise-parameters-reset-and-loop-control">DMG Channel 4 Noise Parameters, Reset and Loop Control</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Offset</th><th>Name</th></tr></thead><tbody>
<tr><td>0x07C</td><td>REG_SOUND4CNT_H</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Bit(s)</th><th>Effect</th><th>Access</th></tr></thead><tbody>
<tr><td>2-0</td><td>Clock divider frequency (with f=4.194304 Mhz/8) <br> 000: f*2 <br> 001: f <br> 010: f/2 <br> 011: f/3 <br> 100: f/4 <br> 101: f/5 <br> 110: f/6 <br> 111: f/7</td><td>RW</td></tr>
<tr><td>3</td><td>Counter stages: <br> 0=15 stages, 1=7 stages</td><td>RW</td></tr>
<tr><td>7-4</td><td>Counter Pre-Stepper frequency (with Q=clock divider's output frequency): <br> 0000: Q/2 <br> 0001: Q/2^2 <br> 0010: Q/2^3 <br> 0011: Q/2^4 <br> .... <br> 1101: Q/2^14 <br> 1110: Not used <br> 1111: Not used</td><td>RW</td></tr>
<tr><td>D-8</td><td>Unused</td><td></td></tr>
<tr><td>E</td><td>Timed mode: <br> 0=continuous, 1=timed</td><td>RW</td></tr>
<tr><td>F</td><td>Sound Reset</td><td>W</td></tr>
</tbody></table>
</div>
<p><em>Notes</em></p>
<ol>
<li>Channel 4 produces pseudo-noise generated by a polynomial counter. It is based on a 7/15 stages linear-feedback shift register (LFSR). LFSR counts in a pseudo-random order where each state is generated once and only once during the whole count sequence. The sound is produced by the least significant bit's output stage.</li>
<li>A Clock divider controlled by bits 0-2 divides the CPU frequency. Its output is then fed into the counter's pre-scaler (controlled by bits 4-7) which divides further more the frequency.</li>
<li>The Counter stages controls the period of the polynomial counter. It is given by (2^n)-1 where n=number of stages. So for n=7, the pseudo-noise period lasts 63 input clocks. After that, the counter restarts the same count sequence.</li>
<li>When Bit E (Timed mode) is set to 0, sound 4 is played continuously regardless of the length data in REG_SOUND4CNT_L. When set to 1, sound is played for that specified length and after that, bit 3 of REG_SOUNDCNT_X is reset.</li>
<li>When bit F is set to 1, Envelope is set to initial value, the LFSR count sequence is resetted and the sound restarts.</li>
<li>Note that in continuous mode, all parameters can be changed but sound need to be resetted when modifying the envelope initial volume or the clock divider for changes to take effects.</li>
</ol>
<h2 id="acronyms-used"><a class="header" href="#acronyms-used">Acronyms used</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Acronym</th><th>Meaning</th></tr></thead><tbody>
<tr><td>DAC</td><td>Digital-to-Analog Converters</td></tr>
<tr><td>DMA</td><td>Direct Memory Access</td></tr>
<tr><td>DMG</td><td>The original gameboy (Dot Matrix Game)</td></tr>
<tr><td>FIFO</td><td>First-In-First-Out</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../audio/sound4.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../cpu.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../audio/sound4.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../cpu.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
